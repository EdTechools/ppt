import{L as rt,M as lt,N as $e,O as it,P as ut,Q as Ce,R as ct,S as _t,T as pt,U as dt,V as ft,W as mt,X as vt,Y as gt,Z as yt,$ as bt,a0 as ht,a1 as Se,q as qe,a2 as je,a3 as kt,a4 as xt,k as wt,a5 as $t,a6 as Ct,a7 as St,a8 as qt,a9 as jt,aa as Ot,ab as At}from"./modules/unplugin-icons-Ca8F49f6.js";import{d as ie,o as a,b as w,e as f,l as e,F as K,be as ae,h as Tt,x as B,A as te,bT as Oe,r as _,C as n,i as X,k as t,g as d,t as L,c as x,a1 as g,L as It,bm as zt,G as fe,n as Mt,bU as Ft,bi as me,j as Pt,bL as Rt,q as Nt,s as Ut}from"./modules/vue-BOVj5Shv.js";import{O as re,_ as ue,aj as ce,T as Ae,ak as Bt,ai as Et}from"./index-pFKLFa-J.js";import{M as ve}from"./preview-ch6Nsuum.js";import{u as Te}from"./status_store-DRWidOEM.js";import{a as Dt}from"./modules/file-saver-CbIKiJgu.js";import{_ as Vt}from"./default-D_GRZA4c.js";import"./modules/shiki-sKuWUF9L.js";const Ht={class:"w-full max-w-2xl mx-auto p-4"},Jt={class:"flex items-center gap-2 text-gray-600 mb-6"},Lt={class:"sparkle-icon"},Qt={class:"staggered-container"},Gt=["onClick"],Wt={class:"button-content"},Kt=ie({__name:"QuestionsAfterAnswer",props:{content:{}},emits:["questionSelect"],setup(T,{emit:i}){re();const $=i,N=()=>Math.floor(Math.random()*60)-30,I=()=>Math.floor(Math.random()*40)-20,G=()=>Math.floor(Math.random()*40)+200,H=V=>{$("questionSelect",V),console.log("questionSelect",V)};return(V,b)=>{const y=rt;return a(),w("div",Ht,[f("div",Jt,[f("div",Lt,[e(y,{class:"star-path text-lg"})]),b[0]||(b[0]=f("span",{class:"text-sm font-medium tracking-wide"},"试着问问",-1))]),f("div",Qt,[(a(!0),w(K,null,ae(V.content,(h,k)=>(a(),w("button",{key:k,class:"suggestion-button",style:Tt({transform:`translateY(${N()}px) translateX(${I()}px)`,animationDelay:`${k*150}ms`,"--hue":`${G()}deg`}),onClick:A=>H(h)},[f("span",Wt,B(h),1),b[1]||(b[1]=f("div",{class:"button-background"},null,-1))],12,Gt))),128))])])}}}),Xt=ue(Kt,[["__scopeId","data-v-4da30c4e"]]),Yt={class:"waving-hand text-yellow-400"},Zt={__name:"WavingHand",setup(T){return re(),(i,$)=>{const N=lt;return a(),w("div",Yt,[e(N)])}}},en=ue(Zt,[["__scopeId","data-v-223bb2a5"]]),tn={class:"avatar-wrapper"},nn={class:"avatar-inner"},on=["src","alt"],sn={class:"message-content-wrapper"},an={class:"message-bubble"},rn={class:"header-container"},ln={class:"header-content"},un={class:"header-icon"},cn={key:0,class:"suggested-questions"},_n={class:"questions-title"},pn={class:"questions-icon"},dn={class:"questions-container"},fn=["onClick"],mn={class:"question-icon"},vn={class:"question-text"},gn={class:"question-arrow"},yn=ie({__name:"GreetingMseeage",props:{input_text:{},role:{},suggested_questions:{}},emits:["questionClick"],setup(T,{emit:i}){re();const $=T,N=te(()=>$.role==="user"),{copy:I}=Oe({legacy:!0}),G=ce(),H=()=>{I($.input_text),G.success("复制成功")},V=i,b=y=>{V("questionClick",y)};return(y,h)=>{const k=en,A=$e,S=_("n-button"),P=it,E=ut,z=Ce;return a(),w("div",{class:X(["message-container",{"is-user":n(N)}])},[f("div",tn,[f("div",nn,[f("img",{src:n(N)?"/questioner.png":"/party-popper.png",alt:n(N)?"User Avatar":"AI Avatar",class:"avatar"},null,8,on),f("div",{class:X(["avatar-status",{"status-active":!n(N)}])},null,2)])]),f("div",sn,[f("div",an,[f("div",rn,[f("div",ln,[f("span",un,[e(k)]),h[0]||(h[0]=f("span",{class:"header-text"},"以下是本次对话的开场白",-1))]),e(S,{size:"tiny",class:"copy-button",ghost:""},{icon:t(()=>[e(A,{class:"copy-icon",onClick:H})]),_:1})]),e(n(ve),{modelValue:y.input_text,class:"message-markdown"},null,8,["modelValue"]),y.suggested_questions.length>0?(a(),w("div",cn,[f("div",_n,[f("span",pn,[e(P,{class:"text-blue-400"})]),h[1]||(h[1]=f("span",null,"建议的问题",-1))]),f("div",dn,[(a(!0),w(K,null,ae(y.suggested_questions,(u,R)=>(a(),w("div",{key:R,class:"question-bubble",onClick:C=>b(u)},[f("div",mn,[e(E,{class:"text-yellow-400"})]),f("div",vn,B(u),1),f("div",gn,[e(z)])],8,fn))),128))])])):d("v-if",!0)])])],2)}}}),bn=ue(yn,[["__scopeId","data-v-b7f37197"]]),hn={key:0},kn=ie({__name:"InputForm",props:{config:{},username:{},api_key:{}},emits:["update:content"],setup(T,{emit:i}){const $="https://dify.edtools.top",N=i,I=T,{$slidev:G,$nav:H}=re(),V=te(()=>{const z=H.value.currentPage-1;return G.nav.slides[z].meta.slide.note}),b=L({}),y=(z,u)=>{z&&(b.value[u]=L(void 0))},h=te(()=>I.config.map(u=>{let R;return Object.values(u)[0].type=="select"?R={input_label:Object.values(u)[0].label,input_type:Object.values(u)[0].type,input_variable:Object.values(u)[0].variable,required:Object.values(u)[0].required,options:Object.values(u)[0].options}:Object.values(u)[0].type=="text-input"||Object.values(u)[0].type=="paragraph"||Object.values(u)[0].type=="file-list"?R={input_label:Object.values(u)[0].label,input_type:Object.values(u)[0].type,input_variable:Object.values(u)[0].variable,required:Object.values(u)[0].required,max_length:Object.values(u)[0].max_length}:R={input_label:Object.values(u)[0].label,input_type:Object.values(u)[0].type,input_variable:Object.values(u)[0].variable,required:Object.values(u)[0].required},R})),k=(z,u,R)=>{const C=(u==null?void 0:u.target).response,c=JSON.parse(C),U=c.mime_type;let s="";return U.split("/")[0]=="image"?s="image":(U.split("/")[0]=="text"||U.split("/")[0]=="application")&&(s="document"),b.value[R]={type:s,transfer_method:"local_file",upload_file_id:c.id},E.success("文件上传成功"),z},A=(z,u,R)=>{const C=(u==null?void 0:u.target).response,c=JSON.parse(C),U=c.mime_type;let s="";return U.split("/")[0]=="image"?s="image":s="document",b.value[R]?b.value[R].push({type:s,transfer_method:"local_file",upload_file_id:c.id,file_name:c.name}):b.value[R]=[{type:s,transfer_method:"local_file",upload_file_id:c.id,file_name:c.name}],E.success("文件上传成功"),z},S=L(!1),P=()=>{S.value&&N("update:content",b.value),S.value=!S.value},E=ce();return(z,u)=>{const R=ct,C=_("n-button"),c=_("n-flex"),U=_t,s=_("n-text"),o=_("n-h5"),l=_("n-radio-button"),m=_("n-radio-group"),j=_("n-card"),J=_("n-input"),M=_("n-blockquote"),v=_("n-input-number"),Q=_("n-upload"),D=pt,W=_("n-popover"),ee=_("n-infinite-scroll"),se=dt;return a(),x(c,{class:"p-3",vertical:""},{default:t(()=>[e(c,{justify:"center"},{default:t(()=>[e(C,{text:"",style:{"font-size":"18px"},onClick:P},{default:t(()=>[n(S)?d("v-if",!0):(a(),w("div",hn,[e(R),u[0]||(u[0]=f("span",null,"补充会话信息",-1))]))]),_:1})]),_:1}),n(S)?(a(),x(c,{key:0},{default:t(()=>[e(ee,{style:{height:"450px"},distance:10,class:"b-2 b-gray-400"},{default:t(()=>[(a(!0),w(K,null,ae(n(h),(r,Y)=>(a(),x(c,{key:Y,ref_for:!0,ref:q=>y(q,r.input_variable),class:"px-3 p-2",vertical:""},{default:t(()=>[d(" Single Select "),r.input_type=="select"?(a(),x(j,{key:0,"content-style":{padding:"10px",backgroundColor:"#d3ede0"},class:X({"required-field-animation":r.required})},{default:t(()=>[e(c,{vertical:""},{default:t(()=>[e(o,{prefix:"bar"},{default:t(()=>[e(s,{type:"primary"},{default:t(()=>[g(B(r.input_label)+" ",1),r.required?(a(),x(U,{key:0,class:"text-red-400"})):d("v-if",!0)]),_:2},1024)]),_:2},1024),e(m,{value:n(b)[r.input_variable],"onUpdate:value":q=>n(b)[r.input_variable]=q},{default:t(()=>[(a(!0),w(K,null,ae(r.options,(q,Z)=>(a(),x(l,{key:Z,value:q,label:q},null,8,["value","label"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)]),_:2},1032,["class"])):r.input_type=="text-input"?(a(),w(K,{key:1},[d(" Text Input "),e(j,{"content-style":{padding:"10px",backgroundColor:"#edf2fa"},class:X({"required-field-animation":r.required})},{default:t(()=>[e(c,{vertical:""},{default:t(()=>[e(o,{prefix:"bar",type:"info"},{default:t(()=>[e(s,{type:"info"},{default:t(()=>[g(B(r.input_label)+" ",1),r.required?(a(),x(U,{key:0,class:"text-red-400"})):d("v-if",!0)]),_:2},1024)]),_:2},1024),e(J,{value:n(b)[r.input_variable],"onUpdate:value":q=>n(b)[r.input_variable]=q,type:"text",placeholder:"请输入文本内容",maxlength:r.max_length,"show-count":"",clearable:""},null,8,["value","onUpdate:value","maxlength"])]),_:2},1024)]),_:2},1032,["class"])],2112)):r.input_type=="paragraph"&&r.input_variable!="note"?(a(),w(K,{key:2},[d(" Paragraph "),e(j,{"content-style":{padding:"10px",backgroundColor:"#edf2fa"},class:X({"required-field-animation":r.required})},{default:t(()=>[e(c,{vertical:""},{default:t(()=>[e(o,{prefix:"bar",type:"info"},{default:t(()=>[e(s,{type:"info"},{default:t(()=>[g(B(r.input_label)+" ",1),r.required?(a(),x(U,{key:0,class:"text-red-400"})):d("v-if",!0)]),_:2},1024)]),_:2},1024),e(J,{value:n(b)[r.input_variable],"onUpdate:value":q=>n(b)[r.input_variable]=q,type:"textarea",placeholder:"请输入段落内容",maxlength:r.max_length,round:"",clearable:"","show-count":""},null,8,["value","onUpdate:value","maxlength"])]),_:2},1024)]),_:2},1032,["class"])],2112)):r.input_type=="number"?(a(),w(K,{key:3},[d(" Number "),e(j,{"content-style":{padding:"10px",backgroundColor:"#f5f5f5"},class:X({"required-field-animation":r.required})},{default:t(()=>[e(c,{justify:"space-between"},{default:t(()=>[e(M,{class:"text-neutral-200"},{default:t(()=>[e(s,null,{default:t(()=>[g(B(r.input_label)+" ",1),r.required?(a(),x(U,{key:0,class:"text-red-400"})):d("v-if",!0)]),_:2},1024)]),_:2},1024),e(v,{value:n(b)[r.input_variable],"onUpdate:value":q=>n(b)[r.input_variable]=q,placeholder:"请输入数字内容"},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1032,["class"])],2112)):r.input_type=="file"?(a(),w(K,{key:4},[d(" Single File "),e(j,{"content-style":{padding:"10px",backgroundColor:"#fef3c7"},class:X({"required-field-animation":r.required})},{default:t(()=>[e(c,{justify:"space-between"},{default:t(()=>[e(o,{prefix:"bar",type:"warning"},{default:t(()=>[e(s,{type:"warning"},{default:t(()=>[g(B(r.input_label)+"(上传单个文件) ",1),r.required?(a(),x(U,{key:0,class:"text-red-400"})):d("v-if",!0)]),_:2},1024)]),_:2},1024),e(Q,{"directory-dnd":"","show-file-list":!1,onFinish:({file:q,event:Z})=>k(q,Z,r.input_variable),action:n($)+"/v1/files/upload",data:{user:I.username},headers:{Authorization:`Bearer ${I.api_key}`},max:1},{default:t(()=>[e(C,{ghost:"",type:"warning"},{default:t(()=>u[1]||(u[1]=[g("上传文件")])),_:1})]),_:2},1032,["onFinish","action","data","headers"])]),_:2},1024)]),_:2},1032,["class"])],2112)):r.input_type=="file-list"?(a(),w(K,{key:5},[d(" Multiple Files "),e(j,{"content-style":{padding:"10px",backgroundColor:"#fef3c7"},class:X({"required-field-animation":r.required})},{default:t(()=>[e(c,{justify:"space-between"},{default:t(()=>[e(o,{prefix:"bar",type:"warning"},{default:t(()=>[e(s,{type:"warning"},{default:t(()=>[g(B(r.input_label)+"(可上传"+B(r.max_length)+"个文件) ",1),r.required?(a(),x(U,{key:0,class:"text-red-400"})):d("v-if",!0)]),_:2},1024)]),_:2},1024),e(Q,{"directory-dnd":"","show-file-list":!1,onFinish:({file:q,event:Z})=>A(q,Z,r.input_variable),action:n($)+"/v1/files/upload",data:{user:I.username},headers:{Authorization:`Bearer ${I.api_key}`},max:r.max_length},{default:t(()=>[e(C,{ghost:"",type:"warning"},{default:t(()=>u[2]||(u[2]=[g("上传多文件")])),_:1})]),_:2},1032,["onFinish","action","data","headers","max"])]),_:2},1024)]),_:2},1032,["class"])],2112)):r.input_type=="paragraph"&&r.input_variable=="note"?(a(),w(K,{key:6},[d(" Note "),e(c,{justify:"center"},{default:t(()=>[e(W,{trigger:"hover",placement:"bottom"},{trigger:t(()=>[e(C,null,{icon:t(()=>[e(D)]),default:t(()=>[u[3]||(u[3]=g(" 当前页面的注释已自动添加 "))]),_:1})]),default:t(()=>[f("span",null,[e(n(ve),{modelValue:n(V)},null,8,["modelValue"])])]),_:1})]),_:1})],2112)):d("v-if",!0)]),_:2},1024))),128))]),_:1})]),_:1})):d("v-if",!0),n(S)?(a(),x(c,{key:1,justify:"center"},{default:t(()=>[e(C,{text:"",style:{"font-size":"18px"},onClick:P},{default:t(()=>[e(se),u[4]||(u[4]=f("span",null,"关闭",-1))]),_:1})]),_:1})):d("v-if",!0)]),_:1})}}}),xn=ue(kn,[["__scopeId","data-v-d9cce2e0"]]),wn={class:"avatar-wrapper"},$n={class:"avatar-inner"},Cn=["src","alt"],Sn={class:"message-bubble"},qn={class:"message-footer"},jn={key:0,class:"feedback-wrapper"},On={class:"timestamp"},An="/api/v1",Tn=ie({__name:"Message",props:{api_key:{},input_text:{},role:{},sendTime:{},retriever_resource:{type:Boolean},metadata:{},message_id:{}},setup(T){re();const i=T,$=te(()=>i.role==="user"),{copy:N}=Oe({legacy:!0}),I=ce(),G=()=>{N(i.input_text),I.success("复制成功")},H=async(A,S,P)=>{try{return(await(await fetch(`${An}/messages/${A}/feedbacks`,{method:"POST",headers:{Authorization:`Bearer ${i.api_key}`,"Content-Type":"application/json"},body:JSON.stringify({rating:S,user:P})})).json()).result==="success"?(y.value=S,!0):!1}catch(E){return console.error("Error sending feedback:",E),!1}},V=Te(),{username:b}=Ae(V),y=L(""),h=async()=>{const A=y.value==="like"?null:"like";await H(i.message_id,A,b.value)?I.success(A==="like"?"点赞成功":"已取消点赞"):I.error("操作失败，请稍后重试")},k=async()=>{const A=y.value==="dislike"?null:"dislike";await H(i.message_id,A,b.value)?I.success(A==="dislike"?"反馈已提交":"已取消反馈"):I.error("操作失败，请稍后重试")};return(A,S)=>{const P=$e,E=_("n-button"),z=ft,u=mt,R=_("n-button-group"),C=vt,c=gt,U=_("n-breadcrumb-item"),s=yt,o=_("n-breadcrumb"),l=bt,m=_("n-text"),j=ht,J=_("n-flex"),M=_("n-card"),v=_("n-infinite-scroll"),Q=_("n-popover");return a(),w("div",{class:X(["message-container",{"is-user":n($)}])},[f("div",wn,[f("div",$n,[f("img",{src:n($)?"/questioner.png":"/ai.png",alt:n($)?"User Avatar":"AI Avatar",class:"avatar"},null,8,Cn),f("div",{class:X(["avatar-status",{"status-active":!n($)}])},null,2)])]),f("div",null,[f("div",Sn,[f("div",{class:X(["header-container",{"user-header":n($)}])},[e(E,{size:"tiny",class:"copy-button",ghost:""},{icon:t(()=>[e(P,{class:"copy-icon",onClick:G})]),_:1})],2),e(n(ve),{modelValue:A.input_text,class:"message-markdown"},null,8,["modelValue"]),f("div",qn,[n($)?d("v-if",!0):(a(),w("div",jn,[i.role=="model"?(a(),x(R,{key:0,size:"small",class:"feedback-group"},{default:t(()=>[e(E,{onClick:h,class:X(["feedback-btn like",{active:n(y)==="like"}]),round:""},{icon:t(()=>[e(z)]),_:1},8,["class"]),e(E,{onClick:k,class:X(["feedback-btn dislike",{active:n(y)==="dislike"}]),round:""},{icon:t(()=>[e(u)]),_:1},8,["class"])]),_:1})):d("v-if",!0)])),A.retriever_resource?(a(),x(Q,{key:1,trigger:"hover",placement:"right"},{trigger:t(()=>[e(E,{text:""},{default:t(()=>[n($)?d("v-if",!0):(a(),x(C,{key:0}))]),_:1})]),default:t(()=>[e(v,{style:{"max-height":"200px"},distance:10,class:"p-3"},{default:t(()=>[(a(!0),w(K,null,ae(i.metadata.retriever_resources,(D,W)=>(a(),w("div",{key:W},[e(M,{title:"分块编号为:#"+String(D.segment_position),class:"mb-3"},{"header-extra":t(()=>[e(o,null,{default:t(()=>[e(U,null,{default:t(()=>[e(c),g(" "+B(D.dataset_name),1)]),_:2},1024),e(U,null,{default:t(()=>[e(s),g(" "+B(D.document_name),1)]),_:2},1024)]),_:2},1024)]),footer:t(()=>[e(J,{justify:"space-between"},{default:t(()=>[e(m,null,{default:t(()=>[S[0]||(S[0]=g("位置 ")),e(l),g(B(D.position),1)]),_:2},1024),e(m,null,{default:t(()=>[S[1]||(S[1]=g(" 可信分数")),e(j),g(B(Math.round(D.score*100)),1)]),_:2},1024)]),_:2},1024)]),default:t(()=>[g(" "+B(D.content)+" ",1)]),_:2},1032,["title"])]))),128))]),_:1})]),_:1})):d("v-if",!0),f("span",On,B(A.sendTime),1)])])])],2)}}}),ke=ue(Tn,[["__scopeId","data-v-94124ab9"]]),xe="https://dify.edtools.top",we=()=>{const T=new Date,i=(T.getMonth()+1).toString().padStart(2,"0"),$=T.getDate().toString().padStart(2,"0"),N=T.getHours().toString().padStart(2,"0"),I=T.getMinutes().toString().padStart(2,"0"),G=T.getSeconds().toString().padStart(2,"0");return`${i}-${$} ${N}:${I}:${G}`},In=Bt("store_page_session",()=>{const T=L(!1),i=L(),$=L(""),N=async(s,o,l)=>{try{const m=await fetch(`${xe}/v1/messages/${s}/suggested?user=${l}`,{method:"GET",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(!m.ok)throw new Error("Network response was not ok");return await m.json()}catch(m){throw console.error("Error fetching data:",m),m}},I=async(s,o,l,m,j,J)=>{var M;T.value=!0;try{const v={inputs:m,query:s,response_mode:"blocking",conversation_id:`${J}`||"",user:o,files:j},Q=await fetch(`${xe}/v1/chat-messages`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(v)});if(!Q.ok)throw new Error(`HTTP error! status: ${Q.status}`);const D=(M=Q.body)==null?void 0:M.getReader();if(!D)throw new Error("Response body is null");const W=new TextDecoder;for(;;){const{done:ee,value:se}=await D.read();if(ee)break;const r=W.decode(se);try{const Y=JSON.parse(r);return T.value=!1,Y}catch(Y){console.error("Error:",Y),T.value=!1}}}catch(v){console.error("Error:",v),T.value=!1}},G=async(s,o,l,m,j,J)=>{i.value||(i.value={});let M=i.value[s];const v=(M==null?void 0:M.current_conversation_id)||"",Q=await I(o,l,m,j,J,v),{answer:D,message_id:W,conversation_id:ee,metadata:se}=Q,r={content:o,role:"user",sendTime:we()},Y={message_id:W,content:D,role:"model",metadata:se,sendTime:we()};if(M)if(v){const q=M.history[v];if(Array.isArray(q))q.push(r,Y);else{const Z=[r,Y];M.history[v]=Z}}else{const q=[r,Y];M.current_conversation_id=ee,M.history[ee]=q}else{const q=[r,Y];i.value[s]={current_conversation_id:ee,history:{[ee]:q}}}$.value=await N(W,m,l)},H=(s,o="json",l)=>{var W;const m=`page_sessions_${new Date().getTime()}`,j=l?`${l}.${o}`:`${m}.${o}`,J=(W=i.value)==null?void 0:W[s],M=J.current_conversation_id,v={[M]:J.history[M]};if(!J){console.warn("No page session data to export");return}const Q=o==="json"?JSON.stringify(v,null,2):JSON.stringify(v),D=new Blob([Q],{type:o==="json"?"application/json;charset=utf-8":"text/plain;charset=utf-8"});Dt.saveAs(D,j)},V=(s,o)=>{var J;i.value||(i.value={});const l=Object.keys(JSON.parse(o))[0],m=Object.values(JSON.parse(o))[0],j=(J=i.value)==null?void 0:J[s];j?(console.log(`当前页面会话数据${j}`),j.current_conversation_id=l,j.history[l]=m):i.value[s]={current_conversation_id:l,history:o}},b=s=>{var l;const o=(l=i.value)==null?void 0:l[s];return o?!!(o.current_conversation_id&&o.history[o.current_conversation_id]):!1},y=s=>{var o;return!!((o=i.value)!=null&&o[s])},h=(s,o)=>{var l,m,j;return!!((j=(m=(l=i.value)==null?void 0:l[s])==null?void 0:m.history)!=null&&j[o])},k=s=>{var l;const o=(l=i.value)==null?void 0:l[s];return o!=null&&o.current_conversation_id&&o.history[o.current_conversation_id]||null},A=(s,o)=>{i.value||(i.value={}),i.value[s]={current_conversation_id:o,history:{[o]:[]}}},S=(s,o)=>{var m;const l=(m=i.value)==null?void 0:m[s];return l?(l.history[o]||(l.history[o]=[]),l.current_conversation_id=o,!0):!1},P=(s,o)=>{var m;const l=(m=i.value)==null?void 0:m[s];return l&&l.history[o]?(l.history[o]=[],!0):!1},E=s=>{var l;const o=(l=i.value)==null?void 0:l[s];return o?(o.current_conversation_id="",$.value="",!0):!1},z=(s,o)=>{var m;const l=(m=i.value)==null?void 0:m[s];return l?(l.current_conversation_id=o,!0):!1},u=(s,o)=>{var m;const l=(m=i.value)==null?void 0:m[s];return!l||l.current_conversation_id===o?!1:(delete l.history[o],!0)},R=s=>{if(i.value[s]){const o=i.value[s].current_conversation_id,l=i.value[s].history[o];o==""?i.value[s].history={}:i.value[s].history={[o]:l}}},C=s=>{var l;const o=(l=i.value)==null?void 0:l[s];return o?Object.keys(o.history):[]};return{send_status:T,focus_message_info:$,store_page_sessions:i,hasCurrentConversation:b,hasPageSession:y,hasConversation:h,getCurrentConversation:k,createPageSession:A,switchConversation:S,clearConversation:P,deleteConversation:u,getConversationList:C,isConversationEmpty:s=>{const o=k(s);return!(o!=null&&o.length)},sendMessage:G,clearCurrentConversationId:E,setCurrentConversationId:z,historyNumber:s=>{const o=C(s);return k(s)?o.length-1:o.length},clearHistoryForPageSession:R,exportPageSessionToFile:H,importConversation:V}},{persist:{pick:["send_status","store_page_sessions"]}}),zn={key:0},Mn={key:1},Fn={key:2},Pn={key:1},Rn=ie({__name:"ChatPanel",props:{active:Boolean,title:String,api_key:String},emits:["toggleStatus"],setup(T,{emit:i}){const{$slidev:$,$nav:N,$clicksContext:I,$clicks:G,$page:H,$renderContext:V,$frontmatter:b}=re(),y=T,h="https://dify.edtools.top",k=L(null);It(async()=>{try{const O=await fetch(`${h}/v1/parameters`,{method:"GET",headers:{Authorization:`Bearer ${y.api_key}`}});if(!O.ok)throw new Error("Network response was not ok");const p=await O.json();k.value=p}catch(O){console.error("Error fetching data:",O)}});const A=L("left"),{active:S,title:P}=zt(y),E=i,z=L(!1),u=O=>z.value=O;fe(()=>S.value,O=>{u(O)});const R=()=>{E("toggleStatus")},C=L(""),c=te(()=>`${$.nav.currentPage}-${y.title}`),U=te(()=>{let O=[];return k.value.user_input_form.map(p=>{Object.values(p)[0].required==!0&&O.push(Object.values(p)[0].variable)}),O}),s=L({}),o=O=>{s.value=O},l=te(()=>Object.keys(s.value).filter(O=>s.value[O]!=null)),m=te(()=>U.value.every(O=>l.value.includes(O))),j=te(()=>C.value.trim().length>0&&m.value),J=Te(),{username:M}=Ae(J),v=In(),Q=L(null);fe(v,()=>{Mt(()=>{var O;if((O=Q.value)!=null&&O.scrollbarInstRef){const p=Q.value.scrollbarInstRef.containerRef;p&&p.scrollTo({top:p.scrollHeight,behavior:"smooth"})}})},{deep:!0});const D=L([]);te(()=>D.value.length);const W=te(()=>D.value.map(O=>{const{file_name:p,...pe}=O;return pe})),ee=()=>M.value.length===9,se=O=>{ee()?(v.sendMessage(c.value,O,M.value,y.api_key,s.value,W.value),C.value="",D.value=[]):q.warning("发送失败，未输入用户信息")},r=()=>{ee()?(v.sendMessage(c.value,C.value,M.value,y.api_key,s.value,W.value),C.value="",D.value=[]):q.warning("发送失败，未输入用户信息")},Y=()=>{C.value.trim()&&(r(),C.value="")},q=ce(),Z=L(!1),Ie=L("Text"),_e=Ft({dataType:Ie,types:[{description:"text",accept:{"text/plain":[".txt",".html",".json"]}}],excludeAcceptAllOption:!0});fe(_e.data,()=>{v.importConversation(c.value,_e.data.value)});const ze=()=>{v.exportPageSessionToFile(c.value,"json","my_sessions")};return(O,p)=>{const pe=Se,Me=qe,Fe=je,Pe=kt,oe=_("n-button"),Re=xt,de=_("n-button-group"),ne=_("n-flex"),Ne=xn,ge=_("n-message-provider"),Ue=bn,Be=Xt,Ee=_("n-scrollbar"),De=_("n-input"),Ve=_("n-split"),ye=wt,be=_("n-tooltip"),He=_("n-badge"),Je=$t,Le=Ct,Qe=Ce,he=St,Ge=qt,We=jt,Ke=Ot,Xe=_("n-card"),Ye=_("n-thing"),Ze=_("n-list-item"),et=_("n-list"),tt=_("n-modal"),nt=_("n-modal-provider"),ot=_("n-drawer-content"),st=_("n-drawer");return a(),x(st,{show:n(z),"onUpdate:show":p[6]||(p[6]=F=>me(z)?z.value=F:null),"default-width":400,"min-width":300,"max-width":1e3,placement:n(A),"on-after-leave":R,resizable:""},{default:t(()=>[e(ot,{closable:""},{header:t(()=>[e(ne,{justify:"space-between"},{default:t(()=>[n(P)=="课前 AI 推荐"?(a(),w("p",zn,[e(pe,{class:"color-green-600 mr-4"}),g(" "+B(n(P)),1)])):d("v-if",!0),n(P)=="课中 AI 问答"?(a(),w("p",Mn,[e(Me,{class:"color-green-600 mr-4"}),g(" "+B(n(P)),1)])):d("v-if",!0),n(P)=="课后 AI 检测"?(a(),w("p",Fn,[e(Fe,{class:"color-green-600 mr-4"}),g(" "+B(n(P)),1)])):d("v-if",!0),e(de,{size:"small"},{default:t(()=>[e(oe,{onClick:ze,type:"default",disabled:!n(v).hasCurrentConversation(n(c))},{icon:t(()=>[e(Pe)]),default:t(()=>[p[7]||(p[7]=g(" 导出 "))]),_:1},8,["disabled"]),e(oe,{type:"default",onClick:p[0]||(p[0]=F=>n(_e).open())},{icon:t(()=>[e(Re)]),default:t(()=>[p[8]||(p[8]=g(" 导入 "))]),_:1})]),_:1})]),_:1})]),footer:t(()=>[e(ne,{style:{width:"100%"},justify:"space-between"},{default:t(()=>[d(" 会话管理界面（分享、历史、清空） "),e(ne,null,{default:t(()=>[e(ne,null,{default:t(()=>[e(He,{value:n(v).historyNumber(n(c))},{default:t(()=>[e(be,{trigger:"hover",placement:"bottom"},{trigger:t(()=>[e(oe,{text:"",style:{"font-size":"21px"},onClick:p[2]||(p[2]=F=>Z.value=!0)},{default:t(()=>[e(ye)]),_:1})]),default:t(()=>[p[10]||(p[10]=g(" 历史话题 "))]),_:1})]),_:1},8,["value"]),d(` <n-tooltip trigger="hover" placement="bottom">\r
                                    <template #trigger>\r
                                        <n-button text type="error" style="font-size: 21px" @click="deleteCurrentConversation">\r
                                            <carbon:trash-can />\r
                                        </n-button>\r
                                    </template>\r
                                    删除该会话\r
                                </n-tooltip> `),e(be,{trigger:"hover",placement:"bottom"},{trigger:t(()=>[e(oe,{text:"",style:{"font-size":"19px"},onClick:p[3]||(p[3]=F=>n(v).clearCurrentConversationId(n(c)))},{default:t(()=>[e(Je)]),_:1})]),default:t(()=>[p[11]||(p[11]=g(" 新建话题 "))]),_:1})]),_:1})]),_:1}),d(" 执行输入界面（上传按钮、发送按钮） "),e(de,null,{default:t(()=>[d(" 上传文件显示 "),d(` <n-popover style="min-width: 200px;min-height: 50px" trigger="hover">\r
                            <template #trigger>\r
                                <n-badge :value="fileCount" :max="15" :offset="[-10, 0]">\r
                                    <n-button @click="showModal = true">\r
                                        <template #icon>\r
                                            <carbon:folder-parent />\r
                                        </template>\r
                                        上传\r
                                    </n-button>\r
                                </n-badge>\r
                            </template>\r
                            <n-infinite-scroll v-if="files.length" :distance="3">\r
                                <n-thing style="min-width: 200px;" v-for="(file, index) in files" :key="index">\r
                                    <template #header>\r
                                        <carbon:link />\r
                                        <n-text>{{ file.file_name }}</n-text>\r
                                    </template>\r
                                    <template #header-extra>\r
                                        <n-button ghost type="error" size="tiny" @click="handleDelete(index)">\r
                                            <carbon:trash-can />\r
                                        </n-button>\r
                                    </template>\r
                                </n-thing>\r
                            </n-infinite-scroll>\r
                            <n-text v-else class="">点击下方按钮上传文件</n-text>\r
                        </n-popover> `),n(v).send_status?(a(),x(oe,{key:0,type:"info",ghost:"",onClick:r,disabled:""},{icon:t(()=>[e(Le)]),default:t(()=>[p[12]||(p[12]=g(" 正在思考 "))]),_:1})):(a(),x(oe,{key:1,type:"primary",ghost:"",onClick:r,disabled:!n(j)},{icon:t(()=>[e(Qe)]),default:t(()=>[p[13]||(p[13]=g(" 发送 "))]),_:1},8,["disabled"]))]),_:1})]),_:1})]),default:t(()=>[e(Ve,{direction:"vertical",style:{height:"100%"},"default-size":.8,"resize-trigger-size":5,min:.2,max:.8},{1:t(()=>[e(Ee,{ref_key:"scrollbarRef",ref:Q,class:"mt-3"},{default:t(()=>[d(" 测试渲染内容 "),d(" {{ responseData }} "),d(" 测试渲染内容 "),d(" 输入内容 "),d(" 补充会话信息 "),e(ge,{placement:"top-left"},{default:t(()=>[Array.isArray(n(k).user_input_form)&&n(k).user_input_form.length>0?(a(),x(Ne,{key:0,"onUpdate:content":o,config:n(k).user_input_form,api_key:y.api_key,username:n(M)},null,8,["config","api_key","username"])):d("v-if",!0)]),_:1}),d(" 开场白 "),n(k).opening_statement?(a(),x(Ue,{key:0,input_text:n(k).opening_statement,suggested_questions:n(k).suggested_questions,role:"model",onQuestionClick:se},null,8,["input_text","suggested_questions"])):d("v-if",!0),n(v).hasPageSession(n(c))&&n(v).hasCurrentConversation(n(c))?(a(),w("div",Pn,[(a(!0),w(K,null,ae(n(v).getCurrentConversation(n(c)),(F,le)=>(a(),x(ne,{key:le,vertical:""},{default:t(()=>[e(ge,{placement:"top-left"},{default:t(()=>[F.role=="user"?(a(),x(ke,{key:0,api_key:y.api_key,retriever_resource:n(k).retriever_resource.enabled,input_text:F.content,role:F.role,sendTime:F.sendTime},null,8,["api_key","retriever_resource","input_text","role","sendTime"])):(a(),x(ke,{key:1,api_key:y.api_key,input_text:F.content,retriever_resource:n(k).retriever_resource.enabled,metadata:F.metadata,role:F.role,sendTime:F.sendTime,message_id:F.message_id},null,8,["api_key","input_text","retriever_resource","metadata","role","sendTime","message_id"]))]),_:2},1024)]),_:2},1024))),128))])):d("v-if",!0),n(k).suggested_questions_after_answer.enabled&&n(v).focus_message_info.result=="success"?(a(),x(Be,{key:2,content:n(v).focus_message_info.data,onQuestionSelect:se},null,8,["content"])):d("v-if",!0)]),_:1},512)]),2:t(()=>[e(ne,{style:{width:"100%",height:"100%"},justify:"end",vertical:""},{default:t(()=>[d(" 用户消息输入（消息输入框） "),e(De,{value:n(C),"onUpdate:value":p[1]||(p[1]=F=>me(C)?C.value=F:null),onKeydown:Pt(Rt(Y,["prevent"]),["enter"]),class:"mt-2",style:{height:"100%"},"show-count":!0,round:!0,placeholder:"请在此输入内容......",type:"textarea",size:"large",clearable:""},null,8,["value","onKeydown"])]),_:1})]),"resize-trigger":t(()=>p[9]||(p[9]=[f("div",{style:{width:"100%",height:"100%",backgroundColor:"#bfbfbf",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"8px"}},null,-1)])),_:1}),e(nt,null,{default:t(()=>[e(tt,{show:n(Z),"onUpdate:show":p[5]||(p[5]=F=>me(Z)?Z.value=F:null),title:"该页历史会话",style:{width:"600px"},preset:"card"},{"header-extra":t(()=>[e(oe,{text:"",onClick:p[4]||(p[4]=F=>n(v).clearHistoryForPageSession(n(c))),ghost:"",type:"error"},{icon:t(()=>[e(he)]),default:t(()=>[p[14]||(p[14]=g(" 全部清除！ "))]),_:1})]),default:t(()=>[e(et,null,{default:t(()=>[e(Ze,null,{default:t(()=>[d(" 不要显示当前会话 "),(a(!0),w(K,null,ae(n(v).store_page_sessions[n(c)].history,(F,le)=>(a(),x(Ye,{key:le},{default:t(()=>[le!==n(v).store_page_sessions[n(c)].current_conversation_id?(a(),x(Xe,{key:0,class:"mb-3",segmented:{content:!0,footer:"soft"}},{action:t(()=>[e(ne,{justify:"space-between"},{default:t(()=>[e(de,{size:"small"},{default:t(()=>[e(oe,{onClick:at=>n(v).setCurrentConversationId(n(c),le),ghost:"",round:""},{icon:t(()=>[e(Ke)]),default:t(()=>[p[15]||(p[15]=g(" 选中 "))]),_:2},1032,["onClick"]),e(oe,{onClick:at=>n(v).deleteConversation(n(c),le),ghost:"",round:""},{icon:t(()=>[e(he)]),default:t(()=>[p[16]||(p[16]=g(" 删除 "))]),_:2},1032,["onClick"])]),_:2},1024),f("div",null,[e(ye),g(" "+B(F[0].sendTime),1)])]),_:2},1024)]),default:t(()=>[e(ne,{justify:"space-between"},{default:t(()=>[e(ne,{style:{width:"100%"},class:"bg-blue-100 p-2",justify:"end"},{default:t(()=>[g(B(F[0].content),1),e(Ge,{style:{"font-size":"20px"}})]),_:2},1024),e(ne,{class:"bg-yellow-100 p-2"},{default:t(()=>[e(We,{style:{"font-size":"20px"}}),g(B(F[1].content.slice(0,100)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):d("v-if",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1})]),_:1},8,["show","placement"])}}}),Nn=ie({__name:"AIButton",setup(T){const{$frontmatter:i}=re(),{pre:$,mid:N,pos:I}=i,G=[{title:"课前 AI 推荐",key:$},{title:"课中 AI 问答",key:N},{title:"课后 AI 检测",key:I}],H=L(null),V=y=>{H.value=H.value===y?null:y},b=()=>{H.value=null};return(y,h)=>{const k=At,A=Se,S=_("n-icon"),P=_("n-float-button"),E=_("n-tooltip"),z=qe,u=je,R=Rn,C=_("n-message-provider");return a(),x(P,{right:0,bottom:0,type:"primary","menu-trigger":"hover",class:"mb-10 mr-5"},{menu:t(()=>[e(E,{trigger:"hover",placement:"left"},{trigger:t(()=>[e(P,{onClick:h[0]||(h[0]=c=>V(1))},{default:t(()=>[e(S,null,{default:t(()=>[e(A)]),_:1})]),_:1})]),default:t(()=>[h[3]||(h[3]=g(" 课前 AI 推荐 "))]),_:1}),e(E,{trigger:"hover",placement:"left"},{trigger:t(()=>[e(P,{onClick:h[1]||(h[1]=c=>V(2))},{default:t(()=>[e(S,null,{default:t(()=>[e(z)]),_:1})]),_:1})]),default:t(()=>[h[4]||(h[4]=g(" 课中 AI 问答 "))]),_:1}),e(E,{trigger:"hover",placement:"left"},{trigger:t(()=>[e(P,{onClick:h[2]||(h[2]=c=>V(3))},{default:t(()=>[e(S,null,{default:t(()=>[e(u)]),_:1})]),_:1})]),default:t(()=>[h[5]||(h[5]=g(" 课后 AI 检测 "))]),_:1}),e(C,null,{default:t(()=>[(a(),w(K,null,ae(G,(c,U)=>e(R,{key:U,active:n(H)===U+1,onToggleStatus:b,title:c.title,api_key:c.key},null,8,["active","title","api_key"])),64))]),_:1})]),default:t(()=>[e(k)]),_:1})}}}),Qn={__name:"slides.md__slidev_10",setup(T){const{$slidev:i,$nav:$,$clicksContext:N,$clicks:I,$page:G,$renderContext:H,$frontmatter:V}=re();return N.setup(),(b,y)=>{const h=_("n-h3"),k=_("n-image"),A=Nn;return a(),x(Vt,Nt(Ut(n(Et)(n(V),9))),{default:t(()=>[e(h,{type:"primary",prefix:"bar"},{default:t(()=>y[0]||(y[0]=[g("3.1 注意同步困境")])),_:1}),e(k,{width:"75%",src:"/attention.svg"}),e(A)]),_:1},16)}}};export{Qn as default};
